# C语言：保留6位有效数字且省略末尾0的完整指南

在C语言中，想要实现“保留有效数字”同时“自动去除末尾无意义的0”，核心方案是使用 **`%g`** 格式说明符。

## 1. 标准解决方案：`%.6g`

最直接的方法是使用 `%.6g`。

- **`%g`**：自动在 `%f`（定点数）和 `%e`（科学计数法）中选择较短的一种，并自动去除末尾的 `0`。
- **`.6`**：表示保留 **6位有效数字**（注意：不是小数点后6位，而是从左边第一个非0数字算起的总位数）。

### 代码示例

~~~
#include <stdio.h>

int main() {
    double num1 = 123.45678;   // 需四舍五入
    double num2 = 12.34000;    // 需去尾0
    double num3 = 0.00123456;  // 小数开头
    
    // 输出: 123.457 (四舍五入保留6位有效数字)
    printf("123.45678  -> %.6g\n", num1);
    
    // 输出: 12.34 (自动去除末尾的0)
    printf("12.34000   -> %.6g\n", num2);
    
    // 输出: 0.00123456 (保留有效数字)
    printf("0.00123456 -> %.6g\n", num3);

    return 0;
}
~~~

## 2. 深入理解%g的机制

1. 自动选择：根据数值大小，自动选择%f或%e中较短的形式
2. 去尾0：12.500自动变成12.5，10.00自动变成10（小数点也会去除）
3. 精度含义：%.6g 代表6位有效数字，%.6f 代表小数点后保留6位

| 格式符 | 含义 | 输出结果 | 说明 |
| :--- | :--- | :--- | :--- |
| **`%.6f`** | 强制6位小数 | `12.340000` | ❌ 保留了无意义的0 |
| **`%.6e`** | 强制科学计数 | `1.234000e+01` | ❌ 格式不直观 |
| **`%.6g`** | **6位有效数字+去0** | **`12.34`** | ✅ 完美符合 |

- 解释说明：%e代表将数据用科学计数法表示，%.6e代表小数点后保留6位

## 3. 如何强制不食用科学计数法

问题：当数字很大的时候，例如1000000，%.6g会默认输出1e+06，如果想输出1000000，只需要对于%g增加精度

- %g只有在数字位数（整数部分）大于精度的时候才会转化为科学计数法。只需要把%.6g写成%.15g就会输出1000000

## 4. 应用例子
1. 小数部分的四舍五入（%.4g）：

| 输入数值 | 设定精度 | 输出结果 | 说明 |
| :--- | :--- | :--- | :--- |
| **12.34`9`** | `%.4g` | **`12.35`** | 第5位是9，进位 |
| **12.34`1`** | `%.4g` | **`12.34`** | 第5位是1，舍去 |

2. 整数部分的四舍五入（%.3g）：

| 输入数值 | 设定精度 | 输出结果 | 说明 |
| :--- | :--- | :--- | :--- |
| **125`9`00** | `%.3g` | **`1.26e+05`** | 第4位是9，进位（触发科学计数法） |
| **125`1`00** | `%.3g` | **`1.25e+05`** | 第4位是1，舍去（触发科学计数法） |